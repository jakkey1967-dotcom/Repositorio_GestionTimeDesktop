<Page
    x:Class="GestionTime.Desktop.Views.ParteItemEdit"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:helpers="using:GestionTime.Desktop.Helpers"
    xmlns:media="using:Microsoft.UI.Xaml.Media"
    mc:Ignorable="d"
    Background="Transparent">

    <!-- ===================== RESOURCES - PALETA EXACTA PANTALLAZO ===================== -->
    <Page.Resources>
        <ResourceDictionary>
            <!-- ðŸŽ¨ PALETA DE COLORES EXACTA DEL PANTALLAZO -->
            <SolidColorBrush x:Key="AccentBrush" Color="#16A8B8"/>
            <SolidColorBrush x:Key="BackgroundBrush" Color="#0F1419"/>
            <SolidColorBrush x:Key="CardBackgroundBrush" Color="#1A2332"/>
            <SolidColorBrush x:Key="CardBorderBrush" Color="#2D3E50"/>
            <SolidColorBrush x:Key="InputBackgroundBrush" Color="#0D1117"/>
            <SolidColorBrush x:Key="InputBorderBrush" Color="#30363D"/>
            <SolidColorBrush x:Key="InputFocusBorderBrush" Color="#16A8B8"/>
            <SolidColorBrush x:Key="TextPrimaryBrush" Color="#E6EDF3"/>
            <SolidColorBrush x:Key="TextSecondaryBrush" Color="#AAB4BF"/>
            <SolidColorBrush x:Key="TextPlaceholderBrush" Color="#484F58"/>
            <SolidColorBrush x:Key="HeaderBrush" Color="#16A8B8"/>
            <SolidColorBrush x:Key="FooterBackgroundBrush" Color="#0D1117"/>
            <SolidColorBrush x:Key="BadgeGreenBrush" Color="#238636"/>
            
            <!-- ðŸ“ ESTILO TEXTBOX -->
            <Style x:Key="ModernTextBox" TargetType="TextBox">
                <Setter Property="Background" Value="{StaticResource InputBackgroundBrush}"/>
                <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
                <Setter Property="BorderBrush" Value="{StaticResource InputBorderBrush}"/>
                <Setter Property="BorderThickness" Value="1"/>
                <Setter Property="CornerRadius" Value="6"/>
                <Setter Property="Padding" Value="12,8"/>
                <Setter Property="FontSize" Value="14"/>
                <Setter Property="Height" Value="38"/>
                <Setter Property="VerticalContentAlignment" Value="Center"/>
            </Style>
            
            <!-- ðŸ“ ESTILO AUTOSUGGESTBOX -->
            <Style x:Key="ModernAutoSuggestBox" TargetType="AutoSuggestBox">
                <Setter Property="Background" Value="{StaticResource InputBackgroundBrush}"/>
                <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
                <Setter Property="BorderBrush" Value="{StaticResource InputBorderBrush}"/>
                <Setter Property="BorderThickness" Value="1"/>
                <Setter Property="CornerRadius" Value="6"/>
                <Setter Property="Height" Value="38"/>
                <Setter Property="VerticalAlignment" Value="Center"/>
                <Setter Property="TextMemberPath" Value=""/>
                <Setter Property="TextBoxStyle">
                    <Setter.Value>
                        <Style TargetType="TextBox">
                            <Setter Property="TextAlignment" Value="Left"/>
                            <Setter Property="HorizontalContentAlignment" Value="Left"/>
                        </Style>
                    </Setter.Value>
                </Setter>
            </Style>
            
            <!-- ðŸ“… ESTILO DATEPICKER -->
            <Style x:Key="ModernDatePicker" TargetType="CalendarDatePicker">
                <Setter Property="Background" Value="{StaticResource InputBackgroundBrush}"/>
                <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
                <Setter Property="BorderBrush" Value="{StaticResource InputBorderBrush}"/>
                <Setter Property="BorderThickness" Value="1"/>
                <Setter Property="CornerRadius" Value="6"/>
                <Setter Property="Height" Value="38"/>
            </Style>
            
            <!-- ðŸ”½ ESTILO COMBOBOX -->
            <Style x:Key="ModernComboBox" TargetType="ComboBox">
                <Setter Property="Background" Value="{StaticResource InputBackgroundBrush}"/>
                <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
                <Setter Property="BorderBrush" Value="{StaticResource InputBorderBrush}"/>
                <Setter Property="BorderThickness" Value="1"/>
                <Setter Property="CornerRadius" Value="6"/>
                <Setter Property="Height" Value="38"/>
            </Style>
            
            <!-- ðŸ”˜ BOTÃ“N PRIMARIO (GRABAR) -->
            <Style x:Key="PrimaryButton" TargetType="Button">
                <Setter Property="Background" Value="{StaticResource AccentBrush}"/>
                <Setter Property="Foreground" Value="White"/>
                <Setter Property="BorderThickness" Value="0"/>
                <Setter Property="CornerRadius" Value="6"/>
                <Setter Property="Padding" Value="20,10"/>
                <Setter Property="FontWeight" Value="SemiBold"/>
                <Setter Property="FontSize" Value="14"/>
                <Setter Property="MinWidth" Value="100"/>
                <Setter Property="Height" Value="40"/>
            </Style>
            
            <!-- ðŸ”˜ BOTÃ“N SECUNDARIO (ANULAR/SALIR) -->
            <Style x:Key="SecondaryButton" TargetType="Button">
                <Setter Property="Background" Value="Transparent"/>
                <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
                <Setter Property="BorderBrush" Value="{StaticResource InputBorderBrush}"/>
                <Setter Property="BorderThickness" Value="1"/>
                <Setter Property="CornerRadius" Value="6"/>
                <Setter Property="Padding" Value="20,10"/>
                <Setter Property="FontWeight" Value="SemiBold"/>
                <Setter Property="FontSize" Value="14"/>
                <Setter Property="MinWidth" Value="100"/>
                <Setter Property="Height" Value="40"/>
            </Style>
            
            <!-- ðŸ“Œ LABEL CAMPO -->
            <Style x:Key="FieldLabel" TargetType="TextBlock">
                <Setter Property="Foreground" Value="{StaticResource TextSecondaryBrush}"/>
                <Setter Property="FontSize" Value="12"/>
                <Setter Property="FontWeight" Value="Normal"/>
                <Setter Property="Margin" Value="0,0,0,4"/>
            </Style>
            
            <!-- ðŸ·ï¸ SECTION TITLE -->
            <Style x:Key="SectionTitle" TargetType="TextBlock">
                <Setter Property="Foreground" Value="{StaticResource AccentBrush}"/>
                <Setter Property="FontSize" Value="12"/>
                <Setter Property="FontWeight" Value="SemiBold"/>
                <Setter Property="Margin" Value="0,0,0,8"/>
            </Style>
        </ResourceDictionary>
    </Page.Resources>

    <!-- ===================== MAIN GRID RESPONSIVE CON FONDO OSCURO ===================== -->
    <Grid x:Name="RootGrid" Padding="8" Opacity="0">
        <!-- FONDO OSCURO SÃ“LIDO -->
        <Grid.Background>
            <SolidColorBrush Color="#0F1419"/>
        </Grid.Background>
        
        <!-- // VISUALSTATEMANAGER - Breakpoints responsive -->
        <VisualStateManager.VisualStateGroups>
            <VisualStateGroup x:Name="WindowSizeStates">
                <!-- // Small: <920px - Una columna, todo apilado -->
                <VisualState x:Name="Small">
                    <VisualState.StateTriggers>
                        <AdaptiveTrigger MinWindowWidth="0" />
                    </VisualState.StateTriggers>
                    <VisualState.Setters>
                        <!-- Card 1: Datos Generales - 1 columna -->
                        <Setter Target="Card1Grid.ColumnDefinitions[0].Width" Value="*"/>
                        <Setter Target="Card1Grid.ColumnDefinitions[1].Width" Value="0"/>
                        <Setter Target="Card1Grid.ColumnDefinitions[2].Width" Value="0"/>
                        <Setter Target="ClienteStack.(Grid.Column)" Value="0"/>
                        <Setter Target="ClienteStack.(Grid.Row)" Value="1"/>
                        <Setter Target="TiendaStack.(Grid.Column)" Value="0"/>
                        <Setter Target="TiendaStack.(Grid.Row)" Value="2"/>
                        
                        <!-- Card 2: InformaciÃ³n de Tiempo - 1 columna -->
                        <Setter Target="Card2Grid.ColumnDefinitions[0].Width" Value="*"/>
                        <Setter Target="Card2Grid.ColumnDefinitions[1].Width" Value="0"/>
                        <Setter Target="Card2Grid.ColumnDefinitions[2].Width" Value="0"/>
                        <Setter Target="Card2Grid.ColumnDefinitions[3].Width" Value="0"/>
                        <Setter Target="Card2Grid.ColumnDefinitions[4].Width" Value="0"/>
                        <Setter Target="HoraFinStack.(Grid.Column)" Value="0"/>
                        <Setter Target="HoraFinStack.(Grid.Row)" Value="1"/>
                        <Setter Target="TicketStack.(Grid.Column)" Value="0"/>
                        <Setter Target="TicketStack.(Grid.Row)" Value="2"/>
                        <Setter Target="GrupoStack.(Grid.Column)" Value="0"/>
                        <Setter Target="GrupoStack.(Grid.Row)" Value="3"/>
                        <Setter Target="TipoStack.(Grid.Column)" Value="0"/>
                        <Setter Target="TipoStack.(Grid.Row)" Value="4"/>
                        
                        <!-- Botones footer - apilados verticalmente -->
                        <Setter Target="FooterButtons.Orientation" Value="Vertical"/>
                        <Setter Target="FooterButtons.HorizontalAlignment" Value="Stretch"/>
                    </VisualState.Setters>
                </VisualState>

                <!-- // Medium: >=920px && <1200px - HÃ­brido OPTIMIZADO -->
                <VisualState x:Name="Medium">
                    <VisualState.StateTriggers>
                        <AdaptiveTrigger MinWindowWidth="920" />
                    </VisualState.StateTriggers>
                    <VisualState.Setters>
                        <!-- Card 1: 3 columnas compactas (Fecha | Cliente | Tienda) -->
                        <Setter Target="Card1Grid.ColumnDefinitions[0].Width" Value="150"/>
                        <Setter Target="Card1Grid.ColumnDefinitions[1].Width" Value="*"/>
                        <Setter Target="Card1Grid.ColumnDefinitions[2].Width" Value="200"/>
                        <Setter Target="ClienteStack.(Grid.Column)" Value="1"/>
                        <Setter Target="ClienteStack.(Grid.Row)" Value="0"/>
                        <Setter Target="TiendaStack.(Grid.Column)" Value="2"/>
                        <Setter Target="TiendaStack.(Grid.Row)" Value="0"/>
                        
                        <!-- Card 2: 4 columnas en 2 filas (Horas+Ticket | Grupo+Tipo) -->
                        <Setter Target="Card2Grid.ColumnDefinitions[0].Width" Value="110"/>
                        <Setter Target="Card2Grid.ColumnDefinitions[1].Width" Value="110"/>
                        <Setter Target="Card2Grid.ColumnDefinitions[2].Width" Value="170"/>
                        <Setter Target="Card2Grid.ColumnDefinitions[3].Width" Value="*"/>
                        <Setter Target="Card2Grid.ColumnDefinitions[4].Width" Value="*"/>
                        <Setter Target="HoraFinStack.(Grid.Column)" Value="1"/>
                        <Setter Target="HoraFinStack.(Grid.Row)" Value="0"/>
                        <Setter Target="TicketStack.(Grid.Column)" Value="2"/>
                        <Setter Target="TicketStack.(Grid.Row)" Value="0"/>
                        <!-- Grupo y Tipo en la MISMA fila -->
                        <Setter Target="GrupoStack.(Grid.Column)" Value="3"/>
                        <Setter Target="GrupoStack.(Grid.Row)" Value="0"/>
                        <Setter Target="TipoStack.(Grid.Column)" Value="4"/>
                        <Setter Target="TipoStack.(Grid.Row)" Value="0"/>
                    </VisualState.Setters>
                </VisualState>

                <!-- // Large: >=1200px - Layout completo horizontal -->
                <VisualState x:Name="Large">
                    <VisualState.StateTriggers>
                        <AdaptiveTrigger MinWindowWidth="1200" />
                    </VisualState.StateTriggers>
                    <VisualState.Setters>
                        <!-- Card 1: 3 columnas (Fecha | Cliente | Tienda) -->
                        <Setter Target="Card1Grid.ColumnDefinitions[0].Width" Value="150"/>
                        <Setter Target="Card1Grid.ColumnDefinitions[1].Width" Value="*"/>
                        <Setter Target="Card1Grid.ColumnDefinitions[2].Width" Value="220"/>
                        <Setter Target="ClienteStack.(Grid.Column)" Value="1"/>
                        <Setter Target="ClienteStack.(Grid.Row)" Value="0"/>
                        <Setter Target="TiendaStack.(Grid.Column)" Value="2"/>
                        <Setter Target="TiendaStack.(Grid.Row)" Value="0"/>
                        
                        <!-- Card 2: 5 columnas (todas en una fila) -->
                        <Setter Target="Card2Grid.ColumnDefinitions[0].Width" Value="100"/>
                        <Setter Target="Card2Grid.ColumnDefinitions[1].Width" Value="100"/>
                        <Setter Target="Card2Grid.ColumnDefinitions[2].Width" Value="150"/>
                        <Setter Target="Card2Grid.ColumnDefinitions[3].Width" Value="*"/>
                        <Setter Target="Card2Grid.ColumnDefinitions[4].Width" Value="*"/>
                        <Setter Target="HoraFinStack.(Grid.Column)" Value="1"/>
                        <Setter Target="HoraFinStack.(Grid.Row)" Value="0"/>
                        <Setter Target="TicketStack.(Grid.Column)" Value="2"/>
                        <Setter Target="TicketStack.(Grid.Row)" Value="0"/>
                        <Setter Target="GrupoStack.(Grid.Column)" Value="3"/>
                        <Setter Target="GrupoStack.(Grid.Row)" Value="0"/>
                        <Setter Target="TipoStack.(Grid.Column)" Value="4"/>
                        <Setter Target="TipoStack.(Grid.Row)" Value="0"/>
                    </VisualState.Setters>
                </VisualState>
            </VisualStateGroup>
        </VisualStateManager.VisualStateGroups>
        
        <!-- // Grid principal con 3 filas: Header | Content | Footer -->
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>   <!-- Header -->
            <RowDefinition Height="*"/>      <!-- Content (ScrollViewer) -->
            <RowDefinition Height="Auto"/>   <!-- Footer -->
        </Grid.RowDefinitions>

        <!-- ===================== HEADER - BANNER TEAL (COMPACTO) ===================== -->
        <Border Grid.Row="0" 
                Background="{StaticResource HeaderBrush}" 
                CornerRadius="6" 
                Padding="16">
            <Grid ColumnSpacing="12">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <!-- LOGO con esquinas redondeadas (igual que DiarioPage) -->
                <Border Grid.Column="0" 
                        Background="Transparent" 
                        CornerRadius="6" 
                        VerticalAlignment="Center">
                    <Image x:Name="LogoImageBanner"
                           Source="ms-appx:///Assets/LogoOscuro.png"
                           Stretch="Uniform"
                           MaxHeight="60"
                           HorizontalAlignment="Left"/>
                </Border>
                
                <!-- TÃTULO + USUARIO (compacto) -->
                <StackPanel Grid.Column="1" 
                            VerticalAlignment="Center" 
                            Spacing="2"
                            Margin="8,0,0,0">
                    <!-- TÃ­tulo -->
                    <TextBlock x:Name="TxtTituloParte" 
                               Text="Nuevo Parte"
                               FontSize="14"
                               FontWeight="SemiBold"
                               Foreground="White"/>
                    
                    <!-- Usuario: Icono + Nombre â€¢ Rol â€¢ Email -->
                    <StackPanel Orientation="Horizontal" Spacing="6">
                        <FontIcon FontFamily="Segoe MDL2 Assets" 
                                  Glyph="&#xE77B;" 
                                  FontSize="10" 
                                  Foreground="White" 
                                  Opacity="0.9"
                                  VerticalAlignment="Center"/>
                        <TextBlock x:Name="TxtUserName" 
                                   Text="Francisco Santos"
                                   FontSize="10"
                                   Foreground="White"
                                   Opacity="0.95"
                                   VerticalAlignment="Center"/>
                        <TextBlock Text="â€¢" 
                                   FontSize="10"
                                   Foreground="White"
                                   Opacity="0.6"
                                   VerticalAlignment="Center"/>
                        <TextBlock x:Name="TxtUserRole" 
                                   Text="Usuario"
                                   FontSize="10"
                                   Foreground="White"
                                   Opacity="0.9"
                                   VerticalAlignment="Center"/>
                        <TextBlock Text="â€¢" 
                                   FontSize="10"
                                   Foreground="White"
                                   Opacity="0.6"
                                   VerticalAlignment="Center"/>
                        <TextBlock x:Name="TxtUserEmail" 
                                   Text="msn@tdkportal.com"
                                   FontSize="9"
                                   Foreground="White"
                                   Opacity="0.75"/>
                    </StackPanel>
                </StackPanel>
                
                <!-- BADGE ESTADO (compacto) -->
                <Border x:Name="BadgeEstado"
                        Grid.Column="2"
                        Background="{StaticResource BadgeGreenBrush}"
                        CornerRadius="3"
                        Padding="8,3"
                        VerticalAlignment="Center">
                    <TextBlock x:Name="TxtEstadoParte" 
                               Text="Abierto"
                               FontSize="10"
                               FontWeight="SemiBold"
                               Foreground="White"/>
                </Border>
            </Grid>
        </Border>

        <!-- ===================== CONTENT - SCROLLVIEWER CON 3 CARDS ===================== -->
        <ScrollViewer Grid.Row="1" 
                      VerticalScrollBarVisibility="Auto" 
                      Padding="0,6,0,6">
            <Grid MaxWidth="1400" RowSpacing="8">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>   <!-- Card 1: Datos Generales -->
                    <RowDefinition Height="Auto"/>   <!-- Card 2: InformaciÃ³n de Tiempo -->
                    <RowDefinition Height="*"/>      <!-- Card 3: DescripciÃ³n/AcciÃ³n (estirable) -->
                </Grid.RowDefinitions>
                
                <!-- ========== CARD 1: DATOS GENERALES ========== -->
                <Border Grid.Row="0"
                        Background="{StaticResource CardBackgroundBrush}"
                        BorderBrush="{StaticResource CardBorderBrush}"
                        BorderThickness="1"
                        CornerRadius="8"
                        Padding="12,10">
                    <Grid RowSpacing="8">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>   <!-- TÃ­tulo secciÃ³n -->
                            <RowDefinition Height="Auto"/>   <!-- Campos -->
                        </Grid.RowDefinitions>
                        
                        <!-- // TÃ­tulo SecciÃ³n COMPACTO -->
                        <TextBlock Grid.Row="0"
                                   Text="DATOS GENERALES" 
                                   FontSize="10"
                                   FontWeight="SemiBold"
                                   Foreground="{StaticResource AccentBrush}"
                                   Margin="0,0,0,4"/>
                        
                        <!-- // Grid responsive para campos (3 cols max, adaptable) -->
                        <Grid x:Name="Card1Grid" 
                              Grid.Row="1"
                              ColumnSpacing="12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="150"/>  <!-- Fecha -->
                                <ColumnDefinition Width="*"/>    <!-- Cliente -->
                                <ColumnDefinition Width="220"/>  <!-- Tienda -->
                            </Grid.ColumnDefinitions>
                            
                            <!-- CAMPO: Fecha (Columna 0, Row 0) -->
                            <StackPanel x:Name="FechaStack" Grid.Column="0" Grid.Row="0" Spacing="4">
                                <TextBlock Text="Fecha" Style="{StaticResource FieldLabel}"/>
                                <CalendarDatePicker x:Name="DpFecha"
                                                  Style="{StaticResource ModernDatePicker}"
                                                  DateFormat="{}{day.integer}/{month.integer}/{year.full}"
                                                  TabIndex="0"/>
                            </StackPanel>
                            
                            <!-- CAMPO: Cliente (Columna 1, Row 0) -->
                            <StackPanel x:Name="ClienteStack" Grid.Column="1" Grid.Row="0" Spacing="4">
                                <TextBlock Text="Cliente" Style="{StaticResource FieldLabel}"/>
                                <AutoSuggestBox x:Name="TxtCliente"
                                              Style="{StaticResource ModernAutoSuggestBox}"
                                              PlaceholderText="Buscar o crear cliente..."
                                              TextChanged="OnClienteTextChanged"
                                              SuggestionChosen="OnClienteSuggestionChosen"
                                              QuerySubmitted="OnClienteQuerySubmitted"
                                              TabIndex="1"/>
                            </StackPanel>
                            
                            <!-- CAMPO: Tienda (Columna 2, Row 0) -->
                            <StackPanel x:Name="TiendaStack" Grid.Column="2" Grid.Row="0" Spacing="4">
                                <TextBlock Text="Tienda" Style="{StaticResource FieldLabel}"/>
                                <TextBox x:Name="TxtTienda"
                                       Style="{StaticResource ModernTextBox}"
                                       PlaceholderText="Nombre de tienda"
                                       TabIndex="2"/>
                            </StackPanel>
                            
                        </Grid>
                    </Grid>
                </Border>
                
                <!-- ========== CARD 2: INFORMACIÃ“N DE TIEMPO ========== -->
                <Border Grid.Row="1"
                        Background="{StaticResource CardBackgroundBrush}"
                        BorderBrush="{StaticResource CardBorderBrush}"
                        BorderThickness="1"
                        CornerRadius="8"
                        Padding="12,10">
                    <Grid RowSpacing="8">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>   <!-- TÃ­tulo secciÃ³n -->
                            <RowDefinition Height="Auto"/>   <!-- Campos Row 0 -->
                            <RowDefinition Height="Auto"/>   <!-- Campos Row 1 (si necesario) -->
                            <RowDefinition Height="Auto"/>   <!-- Campos Row 2 (si necesario) -->
                            <RowDefinition Height="Auto"/>   <!-- Campos Row 3 (si necesario) -->
                            <RowDefinition Height="Auto"/>   <!-- Campos Row 4 (si necesario) -->
                        </Grid.RowDefinitions>
                        
                        <!-- // TÃ­tulo SecciÃ³n COMPACTO -->
                        <TextBlock Grid.Row="0"
                                   Text="INFORMACIÃ“N DE TIEMPO" 
                                   FontSize="10"
                                   FontWeight="SemiBold"
                                   Foreground="{StaticResource AccentBrush}"
                                   Margin="0,0,0,4"/>
                        
                        <!-- // Grid responsive (5 cols max, adaptable) -->
                        <Grid x:Name="Card2Grid"
                              Grid.Row="1"
                              Grid.RowSpan="5"
                              ColumnSpacing="12"
                              RowSpacing="8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="100"/>  <!-- Hora Ini -->
                                <ColumnDefinition Width="100"/>  <!-- Hora Fin -->
                                <ColumnDefinition Width="150"/>  <!-- Ticket -->
                                <ColumnDefinition Width="*"/>    <!-- Grupo -->
                                <ColumnDefinition Width="*"/>    <!-- Tipo -->
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            
                            <!-- CAMPO: Hora Inicio (Columna 0, Row 0) -->
                            <StackPanel x:Name="HoraIniStack" Grid.Column="0" Grid.Row="0" Spacing="4">
                                <TextBlock Text="Hora Ini" Style="{StaticResource FieldLabel}"/>
                                <TextBox x:Name="TxtHoraInicio"
                                       Style="{StaticResource ModernTextBox}"
                                       PlaceholderText="HH:mm"
                                       MaxLength="5"
                                       InputScope="Number"
                                       TabIndex="3"/>
                            </StackPanel>
                            
                            <!-- CAMPO: Hora Fin (Columna 1, Row 0) -->
                            <StackPanel x:Name="HoraFinStack" Grid.Column="1" Grid.Row="0" Spacing="4">
                                <TextBlock Text="Hora Fin" Style="{StaticResource FieldLabel}"/>
                                <TextBox x:Name="TxtHoraFin"
                                       Style="{StaticResource ModernTextBox}"
                                       PlaceholderText="HH:mm"
                                       MaxLength="5"
                                       InputScope="Number"
                                       TabIndex="4"/>
                            </StackPanel>
                            
                            <!-- CAMPO: Ticket (Columna 2, Row 0) -->
                            <StackPanel x:Name="TicketStack" Grid.Column="2" Grid.Row="0" Spacing="4">
                                <TextBlock Text="Ticket" Style="{StaticResource FieldLabel}"/>
                                <TextBox x:Name="TxtTicket"
                                       Style="{StaticResource ModernTextBox}"
                                       PlaceholderText="NÃºmero de ticket"
                                       TabIndex="5"/>
                            </StackPanel>
                            
                            <!-- CAMPO: Grupo (Columna 3, Row 0) -->
                            <StackPanel x:Name="GrupoStack" Grid.Column="3" Grid.Row="0" Spacing="4">
                                <TextBlock Text="Grupo" Style="{StaticResource FieldLabel}"/>
                                <ComboBox x:Name="CmbGrupo"
                                        Style="{StaticResource ModernComboBox}"
                                        HorizontalAlignment="Stretch"
                                        TabIndex="6"/>
                            </StackPanel>
                            
                            <!-- CAMPO: Tipo (Columna 4, Row 0) -->
                            <StackPanel x:Name="TipoStack" Grid.Column="4" Grid.Row="0" Spacing="4">
                                <TextBlock Text="Tipo" Style="{StaticResource FieldLabel}"/>
                                <ComboBox x:Name="CmbTipo"
                                        Style="{StaticResource ModernComboBox}"
                                        HorizontalAlignment="Stretch"
                                        TabIndex="7"/>
                            </StackPanel>
                            
                        </Grid>
                    </Grid>
                </Border>
                
                <!-- ========== CARD 3: DESCRIPCIÃ“N / ACCIÃ“N (ESTIRABLE) ========== -->
                <Border Grid.Row="2"
                        Background="{StaticResource CardBackgroundBrush}"
                        BorderBrush="{StaticResource CardBorderBrush}"
                        BorderThickness="1"
                        CornerRadius="8"
                        Padding="12,10"
                        VerticalAlignment="Stretch">
                    <Grid RowSpacing="6">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>    <!-- TÃ­tulo -->
                            <RowDefinition Height="*"/>       <!-- TextBox estirable -->
                        </Grid.RowDefinitions>
                        
                        <!-- // TÃ­tulo SecciÃ³n COMPACTO -->
                        <TextBlock Grid.Row="0"
                                   Text="DESCRIPCIÃ“N / ACCIÃ“N" 
                                   FontSize="10"
                                   FontWeight="SemiBold"
                                   Foreground="{StaticResource AccentBrush}"
                                   Margin="0,0,0,2"/>
                        
                        <!-- CAMPO: AcciÃ³n/DescripciÃ³n (ESTIRABLE - OCUPA TODO EL ESPACIO) -->
                        <TextBox x:Name="TxtAccion"
                                 Grid.Row="1"
                                 TextWrapping="Wrap"
                                 AcceptsReturn="True"
                                 VerticalAlignment="Stretch"
                                 Background="{StaticResource InputBackgroundBrush}"
                                 Foreground="{StaticResource TextPrimaryBrush}"
                                 BorderBrush="{StaticResource InputBorderBrush}"
                                 BorderThickness="1"
                                 CornerRadius="6"
                                 Padding="12,8"
                                 FontSize="14"
                                 MinHeight="120"
                                 PlaceholderText="Describe la acciÃ³n realizada o el problema atendido..."
                                 PreviewKeyDown="OnAccionPreviewKeyDown"
                                 TextChanging="OnAccionTextChanging"
                                 GotFocus="OnAccionGotFocus"
                                 TabIndex="8"/>
                        
                    </Grid>
                </Border>
                
            </Grid>
        </ScrollViewer>

        <!-- ===================== FOOTER - BOTONERA FIJA ===================== -->
        <Border Grid.Row="2" 
                Background="{StaticResource FooterBackgroundBrush}"
                Padding="12,10">
            <StackPanel x:Name="FooterButtons"
                        Orientation="Horizontal" 
                        Spacing="12"
                        HorizontalAlignment="Right">
                
                <!-- BOTÃ“N: Guardar (estilo ToolbarButton) -->
                <Button x:Name="BtnGuardar"
                        Background="Transparent"
                        BorderThickness="1"
                        BorderBrush="{StaticResource AccentBrush}"
                        Width="80"
                        Height="70"
                        Padding="8"
                        CornerRadius="6"
                        Click="OnGuardarClick"
                        PointerEntered="OnButtonPointerEntered"
                        PointerExited="OnButtonPointerExited"
                        TabIndex="9">
                    <StackPanel Spacing="4">
                        <FontIcon FontFamily="Segoe MDL2 Assets" Glyph="&#xE74E;" FontSize="24" Foreground="#10B981"/>
                        <TextBlock Text="Guardar" FontSize="11" Foreground="{StaticResource TextPrimaryBrush}" HorizontalAlignment="Center"/>
                    </StackPanel>
                </Button>
                
                <!-- BOTÃ“N: Guardar y Cerrar (estilo ToolbarButton mÃ¡s ancho) -->
                <Button x:Name="BtnGuardarYCerrar"
                        Background="Transparent"
                        BorderThickness="1"
                        BorderBrush="{StaticResource AccentBrush}"
                        Width="110"
                        Height="70"
                        Padding="6"
                        CornerRadius="6"
                        Click="OnGuardarYCerrarClick"
                        PointerEntered="OnButtonPointerEntered"
                        PointerExited="OnButtonPointerExited"
                        TabIndex="10">
                    <StackPanel Spacing="4">
                        <FontIcon FontFamily="Segoe MDL2 Assets" Glyph="&#xE74E;" FontSize="24" Foreground="#10B981"/>
                        <TextBlock Text="Guardar y Cerrar" FontSize="10" Foreground="{StaticResource TextPrimaryBrush}" HorizontalAlignment="Center" TextWrapping="NoWrap"/>
                    </StackPanel>
                </Button>
                
                <!-- BOTÃ“N: Anular (estilo ToolbarButton) -->
                <Button x:Name="BtnCancelar"
                        Background="Transparent"
                        BorderThickness="1"
                        BorderBrush="{StaticResource AccentBrush}"
                        Width="80"
                        Height="70"
                        Padding="8"
                        CornerRadius="6"
                        Click="OnCancelarClick"
                        PointerEntered="OnButtonPointerEntered"
                        PointerExited="OnButtonPointerExited"
                        TabIndex="11">
                    <StackPanel Spacing="4">
                        <FontIcon FontFamily="Segoe MDL2 Assets" Glyph="&#xE711;" FontSize="24" Foreground="#EF4444"/>
                        <TextBlock Text="Anular" FontSize="11" Foreground="{StaticResource TextPrimaryBrush}" HorizontalAlignment="Center"/>
                    </StackPanel>
                </Button>
                
                <!-- BOTÃ“N: Salir (estilo ToolbarButton) -->
                <Button x:Name="BtnSalir"
                        Background="Transparent"
                        BorderThickness="1"
                        BorderBrush="{StaticResource AccentBrush}"
                        Width="80"
                        Height="70"
                        Padding="8"
                        CornerRadius="6"
                        Click="OnSalirClick"
                        PointerEntered="OnButtonPointerEntered"
                        PointerExited="OnButtonPointerExited"
                        TabIndex="12">
                    <StackPanel Spacing="4">
                        <FontIcon FontFamily="Segoe MDL2 Assets" Glyph="&#xE8BB;" FontSize="24" Foreground="#F59E0B"/>
                        <TextBlock Text="Salir" FontSize="11" Foreground="{StaticResource TextPrimaryBrush}" HorizontalAlignment="Center"/>
                    </StackPanel>
                </Button>
                
            </StackPanel>
        </Border>

        <!-- CAMPOS OCULTOS (compatibilidad) -->
        <StackPanel Grid.Row="2" 
                    Grid.RowSpan="1"
                    Visibility="Collapsed">
            <TextBox x:Name="TxtDuracion" IsTabStop="False"/>
            <TextBox x:Name="TxtGrupo" IsTabStop="False"/>
            <TextBox x:Name="TxtTipo" IsTabStop="False"/>
            <TextBox x:Name="TxtTecnico" IsTabStop="False"/>
            <TextBox x:Name="TxtEstado" IsTabStop="False"/>
            <Button x:Name="BtnAccionGrabar" IsTabStop="False"/>
        </StackPanel>
    </Grid>
</Page>
