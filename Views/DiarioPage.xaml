<Page
    x:Class="GestionTime.Desktop.Views.DiarioPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:helpers="using:GestionTime.Desktop.Helpers"
    mc:Ignorable="d"
    Loaded="OnPageLoaded"
    Background="Transparent"
    FlowDirection="LeftToRight"
    Language="es-ES">

    <Page.Resources>
        <ResourceDictionary>
            <!-- âœ… SOLO CONVERTERS Y ESTILOS - Los temas ahora estÃ¡n en App.xaml -->
            <helpers:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
            <helpers:InverseBoolConverter x:Key="InverseBoolConverter"/>
            <helpers:BoolToColorConverter x:Key="BoolToColorConverter"/>
            <helpers:EstadoToColorConverter x:Key="EstadoToColorConverter"/>
            <helpers:EstadoToIconConverter x:Key="EstadoToIconConverter"/>
            <helpers:EstadoToActionVisibilityConverter x:Key="EstadoToActionVisibilityConverter"/>
            
            <!-- Converters para el estado del servicio -->
            <helpers:ServiceStatusToBrushConverter x:Key="ServiceStatusToBrushConverter"/>
            <helpers:ServiceStatusToTextConverter x:Key="ServiceStatusToTextConverter"/>
            <helpers:ServiceStatusToVisibilityConverter x:Key="ServiceStatusToVisibilityConverter"/>

            <!-- âœ… Converter para colores hexadecimales -->
            <helpers:HexColorToBrushConverter x:Key="HexColorToBrushConverter"/>

            <!-- âœ… Converter para Zebra Rows (filas alternadas) -->
            <helpers:AlternationIndexToBrushConverter x:Key="AlternationIndexToBrushConverter">
                <helpers:AlternationIndexToBrushConverter.EvenBrush>
                    <SolidColorBrush Color="Transparent"/>
                </helpers:AlternationIndexToBrushConverter.EvenBrush>
                <helpers:AlternationIndexToBrushConverter.OddBrush>
                    <SolidColorBrush Color="#14000000"/>
                </helpers:AlternationIndexToBrushConverter.OddBrush>
            </helpers:AlternationIndexToBrushConverter>

            <!-- âœ… ESTILOS (usan ThemeResource de App.xaml) -->
            <Style x:Key="MutedText" TargetType="TextBlock">
                <Setter Property="Foreground" Value="{ThemeResource TextMuted}"/>
            </Style>
            <Style x:Key="PanelBorder" TargetType="Border">
                <Setter Property="Background" Value="{ThemeResource SurfaceBg}"/>
                <Setter Property="BorderBrush" Value="{ThemeResource Stroke}"/>
                <Setter Property="BorderThickness" Value="1"/>
                <Setter Property="CornerRadius" Value="10"/>
            </Style>
            <Style x:Key="TealBar" TargetType="Grid">
                <Setter Property="Height" Value="38"/>
                <Setter Property="Background" Value="{ThemeResource InputBg}"/>
            </Style>
            <Style x:Key="TealInnerTextBox" TargetType="TextBox">
                <Setter Property="Background" Value="Transparent"/>
                <Setter Property="BorderThickness" Value="0"/>
                <Setter Property="Foreground" Value="{ThemeResource InputText}"/>
                <Setter Property="Padding" Value="0"/>
                <Setter Property="FontSize" Value="14"/>
                <Setter Property="VerticalContentAlignment" Value="Center"/>
            </Style>
            <Style x:Key="TealCalendar" TargetType="CalendarDatePicker">
                <Setter Property="Background" Value="{ThemeResource InputBg}"/>
                <Setter Property="Foreground" Value="{ThemeResource InputText}"/>
                <Setter Property="BorderThickness" Value="0"/>
                <Setter Property="CornerRadius" Value="0"/>
                <Setter Property="Height" Value="38"/>
            </Style>
            <Style x:Key="MiniIconButton" TargetType="Button">
                <Setter Property="Background" Value="{ThemeResource ButtonBg}"/>
                <Setter Property="BorderBrush" Value="{ThemeResource ButtonStroke}"/>
                <Setter Property="BorderThickness" Value="1"/>
                <Setter Property="CornerRadius" Value="6"/>
                <Setter Property="Padding" Value="10,8"/>
            </Style>
            <Style x:Key="ThemeButton" TargetType="Button">
                <Setter Property="Background" Value="{ThemeResource ButtonBg}"/>
                <Setter Property="BorderBrush" Value="{ThemeResource ButtonStroke}"/>
                <Setter Property="BorderThickness" Value="1"/>
                <Setter Property="CornerRadius" Value="8"/>
                <Setter Property="Padding" Value="10,8"/>
            </Style>
            <Style x:Key="ToolButton" TargetType="Button">
                <Setter Property="Background" Value="{ThemeResource SurfaceBg}"/>
                <Setter Property="BorderBrush" Value="{ThemeResource Stroke}"/>
                <Setter Property="BorderThickness" Value="1"/>
                <Setter Property="CornerRadius" Value="0"/>
                <Setter Property="MinWidth" Value="72"/>
                <Setter Property="Padding" Value="12,12"/>
            </Style>
            <Style x:Key="ToolbarButton" TargetType="Button">
                <Setter Property="Background" Value="Transparent"/>
                <Setter Property="BorderThickness" Value="1"/>
                <Setter Property="BorderBrush" Value="{ThemeResource Accent}"/>
                <Setter Property="Width" Value="80"/>
                <Setter Property="Height" Value="70"/>
                <Setter Property="Padding" Value="8"/>
                <Setter Property="CornerRadius" Value="6"/>
                <Setter Property="Transitions">
                    <Setter.Value>
                        <TransitionCollection>
                            <RepositionThemeTransition/>
                        </TransitionCollection>
                    </Setter.Value>
                </Setter>
            </Style>
            <Style x:Key="EstadoIconButton" TargetType="Button">
                <Setter Property="Background" Value="Transparent"/>
                <Setter Property="BorderThickness" Value="0"/>
                <Setter Property="Padding" Value="8,4"/>
                <Setter Property="MinWidth" Value="0"/>
                <Setter Property="MinHeight" Value="0"/>
            </Style>

        </ResourceDictionary>
    </Page.Resources>

    <Grid x:Name="RootGrid" Padding="10" RowSpacing="10" Opacity="0">
        <Grid.Background>
            <ImageBrush x:Name="BackgroundImageBrush" 
                       ImageSource="ms-appx:///Assets/diario_bg_dark.png" 
                       Stretch="UniformToFill" 
                       AlignmentX="Center" 
                       AlignmentY="Center"/>
        </Grid.Background>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- BANNER -->
        <Border Grid.Row="0" Background="{ThemeResource BannerBg}" CornerRadius="10" Padding="16">
            <Grid ColumnSpacing="16">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <!-- Logo -->
                <Border Grid.Column="0" Background="Transparent" CornerRadius="6" VerticalAlignment="Center">
                    <Image x:Name="LogoImageBanner" 
                           Source="ms-appx:///Assets/LogoOscuro.png" 
                           Stretch="Uniform"
                           MaxHeight="60"
                           HorizontalAlignment="Left"/>
                </Border>
                
                <!-- TÃ­tulo + Info de Usuario -->
                <StackPanel Grid.Column="1" 
                            VerticalAlignment="Center" 
                            Spacing="4"
                            Margin="8,0,0,0">
                    <!-- TÃ­tulo Principal -->
                    <TextBlock Text="{x:Bind ViewModel.Title, Mode=OneWay}"
                               FontSize="22"
                               FontWeight="SemiBold"
                               Foreground="White"/>
                    
                    <!-- Usuario con botÃ³n Mi Perfil -->
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE77B;" 
                                  FontSize="14" 
                                  Foreground="White" 
                                  Opacity="0.9"
                                  VerticalAlignment="Center"/>
                        <StackPanel Spacing="2">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <TextBlock Text="{x:Bind ViewModel.UserName, Mode=OneWay}"
                                           FontSize="14"
                                           FontWeight="SemiBold"
                                           Foreground="White"/>
                                <TextBlock Text="â€¢" 
                                           FontSize="14"
                                           Foreground="White"
                                           Opacity="0.6"/>
                                <TextBlock Text="{x:Bind ViewModel.UserRole, Mode=OneWay}"
                                           FontSize="14"
                                           FontWeight="SemiBold"
                                           Foreground="White"
                                           Opacity="0.9"/>
                                <!-- ðŸ†• NUEVO: BotÃ³n Mi Perfil -->
                                <Button x:Name="BtnMiPerfil"
                                        Click="OnMiPerfilClick"
                                        Background="Transparent"
                                        BorderBrush="White"
                                        BorderThickness="1"
                                        CornerRadius="12"
                                        Padding="8,2"
                                        VerticalAlignment="Center"
                                        ToolTipService.ToolTip="Ver mi perfil">
                                    <StackPanel Orientation="Horizontal" Spacing="4">
                                        <FontIcon FontFamily="Segoe MDL2 Assets" 
                                                  Glyph="&#xE8B7;" 
                                                  FontSize="10"
                                                  Foreground="White"/>
                                        <TextBlock Text="Mi Perfil" 
                                                   FontSize="10"
                                                   FontWeight="SemiBold"
                                                   Foreground="White"/>
                                    </StackPanel>
                                </Button>
                            </StackPanel>
                            <TextBlock Text="{x:Bind ViewModel.UserEmail, Mode=OneWay}"
                                       FontSize="12"
                                       Foreground="White"
                                       Opacity="0.8"/>
                        </StackPanel>
                    </StackPanel>
                </StackPanel>
                
                <!-- Columna derecha: BotÃ³n Tema + Estado Servicio -->
                <StackPanel Grid.Column="2" 
                            VerticalAlignment="Center"
                            Spacing="12">
                    <!-- BotÃ³n de Tema -->
                    <Button x:Name="BtnTheme" 
                            Background="Transparent" 
                            BorderBrush="White" 
                            BorderThickness="1" 
                            CornerRadius="8" 
                            Padding="10,8" 
                            ToolTipService.ToolTip="Tema"
                            HorizontalAlignment="Center">
                        <FontIcon FontFamily="Segoe MDL2 Assets" Glyph="&#xE700;" Foreground="White"/>
                        <Button.Flyout>
                            <MenuFlyout>
                                <ToggleMenuFlyoutItem x:Name="ThemeSystemItem" Text="Tema del sistema" Click="OnThemeSystem"/>
                                <ToggleMenuFlyoutItem x:Name="ThemeLightItem" Text="Tema claro" Click="OnThemeLight"/>
                                <ToggleMenuFlyoutItem x:Name="ThemeDarkItem" Text="Tema oscuro" Click="OnThemeDark"/>
                            </MenuFlyout>
                        </Button.Flyout>
                    </Button>
                    
                    <!-- Estado del Servicio -->
                    <Grid HorizontalAlignment="Center"
                          ColumnSpacing="8">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        
                        <!-- LED Circular con Glow -->
                        <Grid Grid.Column="0" Width="12" Height="12">
                            <!-- Glow effect (cÃ­rculo exterior difuminado) -->
                            <Ellipse Fill="{x:Bind ViewModel.IsServiceOnline, Mode=OneWay, Converter={StaticResource ServiceStatusToBrushConverter}}"
                                     Opacity="0.4"
                                     Width="16"
                                     Height="16"
                                     HorizontalAlignment="Center"
                                     VerticalAlignment="Center">
                                <Ellipse.RenderTransform>
                                    <ScaleTransform ScaleX="1.3" ScaleY="1.3"/>
                                </Ellipse.RenderTransform>
                            </Ellipse>
                            
                            <!-- LED principal -->
                            <Ellipse Fill="{x:Bind ViewModel.IsServiceOnline, Mode=OneWay, Converter={StaticResource ServiceStatusToBrushConverter}}"
                                     Width="12"
                                     Height="12"/>
                        </Grid>
                        
                        <!-- Texto del Estado -->
                        <StackPanel Grid.Column="1" 
                                    Orientation="Horizontal" 
                                    Spacing="6"
                                    VerticalAlignment="Center">
                            <TextBlock Text="Servicio:"
                                       FontSize="12"
                                       Foreground="White"
                                       Opacity="0.8"
                                       VerticalAlignment="Center"/>
                            <TextBlock Text="{x:Bind ViewModel.IsServiceOnline, Mode=OneWay, Converter={StaticResource ServiceStatusToTextConverter}}"
                                       FontSize="12"
                                       FontWeight="SemiBold"
                                       Foreground="White"
                                       VerticalAlignment="Center"/>
                            
                            <!-- Icono de advertencia (solo offline) -->
                            <FontIcon Glyph="&#xE7BA;" 
                                      FontSize="11" 
                                      Foreground="#FBBF24"
                                      Visibility="{x:Bind ViewModel.IsServiceOnline, Mode=OneWay, Converter={StaticResource ServiceStatusToVisibilityConverter}}"
                                      ToolTipService.ToolTip="Sin conexiÃ³n con el servidor"/>
                        </StackPanel>
                    </Grid>
                </StackPanel>
            </Grid>
        </Border>

        <!-- FILTROS + BOTONES -->
        <Border Grid.Row="1" Background="Transparent" Padding="10">
            <Grid ColumnSpacing="12">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <!-- Columna izquierda: Fecha y BÃºsqueda -->
                <StackPanel Grid.Column="0" Spacing="6" MinWidth="250">
                    <!-- Fecha -->
                    <TextBlock Text="Fecha" Style="{StaticResource MutedText}"/>
                    <StackPanel Orientation="Horizontal" Spacing="4">
                        <CalendarDatePicker x:Name="DpFiltroFecha" 
                                            Style="{StaticResource TealCalendar}" 
                                            Width="180" 
                                            DateFormat="{}{day.integer(2)}-{month.integer(2)}-{year.full}"/>
                        <Button Style="{StaticResource MiniIconButton}" 
                                Click="OnRefrescar" 
                                ToolTipService.ToolTip="Refrescar (F5)" 
                                Height="38">
                            <FontIcon FontFamily="Segoe Fluent Icons" 
                                      Glyph="&#xE72C;" 
                                      Foreground="{ThemeResource Accent}"/>
                        </Button>
                    </StackPanel>
                    
                    <!-- BÃºsqueda (debajo de fecha) -->
                    <TextBlock Text="Buscar" Style="{StaticResource MutedText}" Margin="0,6,0,0"/>
                    <Grid Style="{StaticResource TealBar}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <FontIcon Margin="10,0,8,0" VerticalAlignment="Center" FontFamily="Segoe Fluent Icons" Glyph="&#xE721;" Foreground="White"/>
                        <TextBox Grid.Column="1" x:Name="TxtFiltroQ" Style="{StaticResource TealInnerTextBox}" PlaceholderText="buscar cliente, ticket, acciÃ³n..." TextChanged="OnFiltroQChanged"/>
                    </Grid>
                </StackPanel>
                
                <!-- Barra de botones -->
                <Border Grid.Column="2" BorderBrush="{ThemeResource Accent}" BorderThickness="2" Padding="8" CornerRadius="6" Background="Transparent">
                    <StackPanel Orientation="Horizontal" Spacing="12">
                        <!-- Llamada telefÃ³nica rÃ¡pida -->
                        <Button x:Name="BtnTelefono" Style="{StaticResource ToolbarButton}" Click="OnNuevaLlamada" 
                                ToolTipService.ToolTip="Nueva llamada telefÃ³nica (Ctrl+T)"
                                PointerEntered="OnButtonPointerEntered"
                                PointerExited="OnButtonPointerExited">
                            <StackPanel Spacing="4">
                                <FontIcon Glyph="&#xE717;" FontSize="24" Foreground="#10B981"/>
                                <TextBlock Text="TelÃ©fono" FontSize="11" Foreground="{ThemeResource TextMain}" HorizontalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                        
                        <Button x:Name="BtnNuevo" Style="{StaticResource ToolbarButton}" Click="OnNuevo" 
                                ToolTipService.ToolTip="Nuevo parte (Ctrl+N)"
                                PointerEntered="OnButtonPointerEntered"
                                PointerExited="OnButtonPointerExited">
                            <StackPanel Spacing="4">
                                <FontIcon Glyph="&#xE710;" FontSize="24" Foreground="#3B82F6"/>
                                <TextBlock Text="Nuevo" FontSize="11" Foreground="{ThemeResource TextMain}" HorizontalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                        <Button x:Name="BtnEditar" Style="{StaticResource ToolbarButton}" Click="OnEditar" IsEnabled="False" 
                                ToolTipService.ToolTip="Editar parte seleccionado (Ctrl+E)"
                                PointerEntered="OnButtonPointerEntered"
                                PointerExited="OnButtonPointerExited">
                            <StackPanel Spacing="4">
                                <FontIcon x:Name="IconEditar" Glyph="&#xE70F;" FontSize="24" Foreground="#8B5CF6"/>
                                <TextBlock Text="Editar" FontSize="11" Foreground="{ThemeResource TextMain}" HorizontalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                        
                        <!-- Separador -->
                        <Border Width="1" Height="50" Background="{ThemeResource Stroke}" Margin="4,0" VerticalAlignment="Center"/>
                        
                        <!-- Grupo: VisualizaciÃ³n -->
                        
                        <!-- Separador -->
                        <Border Width="1" Height="50" Background="{ThemeResource Stroke}" Margin="4,0" VerticalAlignment="Center"/>
                        
                        <!-- Grupo: AdministraciÃ³n -->
                        <Button x:Name="BtnBorrar" Style="{StaticResource ToolbarButton}" Click="OnBorrar" IsEnabled="False"
                                ToolTipService.ToolTip="Borrar parte seleccionado (Delete)"
                                PointerEntered="OnButtonPointerEntered"
                                PointerExited="OnButtonPointerExited">
                            <StackPanel Spacing="4">
                                <FontIcon Glyph="&#xE74D;" FontSize="24" Foreground="#EF4444"/>
                                <TextBlock Text="Borrar" FontSize="11" Foreground="{ThemeResource TextMain}" HorizontalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                        
                        <!-- ðŸ†• NUEVO: BotÃ³n Importar Excel -->
                        <Button x:Name="BtnImportar" Style="{StaticResource ToolbarButton}" Click="OnImportarExcel" 
                                ToolTipService.ToolTip="Importar partes desde Excel (Ctrl+I)"
                                PointerEntered="OnButtonPointerEntered"
                                PointerExited="OnButtonPointerExited">
                            <StackPanel Spacing="4">
                                <FontIcon Glyph="&#xE8B5;" FontSize="24" Foreground="#8B5CF6"/>
                                <TextBlock Text="Importar" FontSize="11" Foreground="{ThemeResource TextMain}" HorizontalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                        
                        <!-- Separador -->
                        <Border Width="1" Height="50" Background="{ThemeResource Stroke}" Margin="4,0" VerticalAlignment="Center"/>
                    </StackPanel>
                </Border>
            </Grid>
        </Border>

        <!-- LISTVIEW CON SURFACE CONTAINER -->
        <Border Grid.Row="2" 
                Background="#1F000000"
                BorderBrush="#330FA7B6"
                BorderThickness="1"
                CornerRadius="14"
                Padding="12">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Cabecera -->
                <Grid x:Name="HeaderGrid" Background="{ThemeResource AccentDark}" Padding="8" CornerRadius="8,8,0,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="70"/>
                        <ColumnDefinition Width="90"/>
                        <ColumnDefinition Width="55"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="55"/>
                        <ColumnDefinition Width="55"/>
                        <ColumnDefinition Width="45"/>
                        <ColumnDefinition Width="65"/>
                        <ColumnDefinition Width="70"/>
                        <ColumnDefinition Width="70"/>
                        <ColumnDefinition Width="90"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Grid.Column="0" Text="Fecha" Foreground="White" FontWeight="SemiBold" FontSize="12"/>
                    <TextBlock Grid.Column="1" Text="Cliente" Foreground="White" FontWeight="SemiBold" FontSize="12"/>
                    <TextBlock Grid.Column="2" Text="Tienda" Foreground="White" FontWeight="SemiBold" FontSize="12"/>
                    <TextBlock Grid.Column="3" Text="AcciÃ³n" Foreground="White" FontWeight="SemiBold" FontSize="12"/>
                    <TextBlock Grid.Column="4" Text="Inicio" Foreground="White" FontWeight="SemiBold" FontSize="12"/>
                    <TextBlock Grid.Column="5" Text="Fin" Foreground="White" FontWeight="SemiBold" FontSize="12"/>
                    <!-- ðŸ†• Header "Dur." con tooltip dinÃ¡mico -->
                    <TextBlock x:Name="DuracionHeader" 
                               Grid.Column="6" 
                               Text="Dur." 
                               Foreground="White" 
                               FontWeight="SemiBold" 
                               FontSize="12"
                               ToolTipService.ToolTip="Pasa el ratÃ³n para ver estadÃ­sticas de tiempo"
                               ToolTipService.Placement="Bottom"/>
                    <TextBlock Grid.Column="7" Text="Ticket" Foreground="White" FontWeight="SemiBold" FontSize="12"/>
                    <TextBlock Grid.Column="8" Text="Grupo" Foreground="White" FontWeight="SemiBold" FontSize="12"/>
                    <TextBlock Grid.Column="9" Text="Tipo" Foreground="White" FontWeight="SemiBold" FontSize="12"/>
                    <TextBlock Grid.Column="10" Text="Estado" Foreground="White" FontWeight="SemiBold" FontSize="12" HorizontalAlignment="Center"/>
                </Grid>

                <!-- âœ… ListView con Zebra Rows -->
                <ListView Grid.Row="1" 
                          x:Name="LvPartes" 
                          SelectionMode="Single" 
                          Background="Transparent" 
                          BorderThickness="0" 
                          SelectionChanged="OnPartesSelectionChanged">
                    <!-- âœ… RECURSOS DE ESTADOS VISUALES CON COLORES DIRECTOS -->
                    <ListView.Resources>
                        <!-- âœ… FONDO POR DEFECTO - TRANSPARENTE PARA PERMITIR ZEBRA ROWS -->
                        <SolidColorBrush x:Key="ListViewItemBackground" Color="Transparent"/>
                        
                        <!-- Fondo sutil para hover -->
                        <SolidColorBrush x:Key="ListViewItemBackgroundPointerOver" Color="#22FFFFFF"/>
                        
                        <!-- Fondo mÃ¡s marcado para pressed -->
                        <SolidColorBrush x:Key="ListViewItemBackgroundPressed" Color="#33FFFFFF"/>
                        
                        <!-- Fondo suave con acento para selected -->
                        <SolidColorBrush x:Key="ListViewItemBackgroundSelected" Color="#2A0FA7B6"/>
                        
                        <!-- Fondo mÃ¡s visible para selected + hover -->
                        <SolidColorBrush x:Key="ListViewItemBackgroundSelectedPointerOver" Color="#3A0FA7B6"/>
                        
                        <!-- Selected + Pressed -->
                        <SolidColorBrush x:Key="ListViewItemBackgroundSelectedPressed" Color="#450FA7B6"/>
                        
                        <!-- Mantener bordes transparentes en todos los estados -->
                        <SolidColorBrush x:Key="ListViewItemBorderBrushPointerOver" Color="Transparent"/>
                        <SolidColorBrush x:Key="ListViewItemBorderBrushPressed" Color="Transparent"/>
                        <SolidColorBrush x:Key="ListViewItemBorderBrushSelected" Color="Transparent"/>
                        <SolidColorBrush x:Key="ListViewItemBorderBrushSelectedPointerOver" Color="Transparent"/>
                        <SolidColorBrush x:Key="ListViewItemBorderBrushSelectedPressed" Color="Transparent"/>
                        
                        <!-- Color de texto para tema oscuro (blanco) -->
                        <SolidColorBrush x:Key="ListViewItemForeground" Color="#EDEFF2"/>
                        <SolidColorBrush x:Key="ListViewItemForegroundPointerOver" Color="#EDEFF2"/>
                        <SolidColorBrush x:Key="ListViewItemForegroundPressed" Color="#EDEFF2"/>
                        <SolidColorBrush x:Key="ListViewItemForegroundSelected" Color="#EDEFF2"/>
                        <SolidColorBrush x:Key="ListViewItemForegroundSelectedPointerOver" Color="#EDEFF2"/>
                        
                        <!-- Desactivar efecto de revelaciÃ³n (Reveal) -->
                        <x:Boolean x:Key="ListViewItemRevealBackgroundShowsAboveContent">False</x:Boolean>
                    </ListView.Resources>
                    
                    <!-- âœ… ItemContainerStyle sin Background (se establece dinÃ¡micamente) -->
                    <ListView.ItemContainerStyle>
                        <Style TargetType="ListViewItem">
                            <!-- Background se establece dinÃ¡micamente en ContainerContentChanging -->
                            <Setter Property="Padding" Value="0"/>
                            <Setter Property="Margin" Value="0,0,0,1"/>
                            <Setter Property="MinHeight" Value="0"/>
                            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                        </Style>
                    </ListView.ItemContainerStyle>
                    <ListView.ItemTemplate>
                        <DataTemplate>
                            <Grid Padding="8,6">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="70"/>
                                    <ColumnDefinition Width="90"/>
                                    <ColumnDefinition Width="55"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="55"/>
                                    <ColumnDefinition Width="55"/>
                                    <ColumnDefinition Width="45"/>
                                    <ColumnDefinition Width="65"/>
                                    <ColumnDefinition Width="70"/>
                                    <ColumnDefinition Width="70"/>
                                    <ColumnDefinition Width="90"/>  <!-- âœ… Aumentado para pill de estado -->
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="{Binding FechaText}" TextWrapping="NoWrap" FontSize="12" Foreground="{ThemeResource TextMain}"/>
                                <TextBlock Grid.Column="1" Text="{Binding Cliente}" TextTrimming="CharacterEllipsis" TextWrapping="NoWrap" FontSize="12" Foreground="{ThemeResource TextMain}"/>
                                <TextBlock Grid.Column="2" Text="{Binding Tienda}" TextTrimming="CharacterEllipsis" TextWrapping="NoWrap" FontSize="12" Foreground="{ThemeResource TextMain}"/>
                                
                                <!-- âœ… Columna AcciÃ³n con Multiline (MaxLines=2) y Tooltip -->
                                <TextBlock Grid.Column="3" 
                                           Text="{Binding Accion}" 
                                           TextWrapping="Wrap"
                                           TextTrimming="CharacterEllipsis"
                                           MaxLines="2"
                                           FontSize="12" 
                                           Foreground="{ThemeResource TextMain}"
                                           ToolTipService.ToolTip="{Binding Accion}"
                                           ToolTipService.Placement="Bottom"/>
                                
                                <TextBlock Grid.Column="4" Text="{Binding HoraInicio}" TextWrapping="NoWrap" FontSize="12" Foreground="{ThemeResource TextMain}"/>
                                <TextBlock Grid.Column="5" Text="{Binding HoraFin}" TextWrapping="NoWrap" FontSize="12" Foreground="{ThemeResource TextMain}"/>
                                <TextBlock Grid.Column="6" Text="{Binding DuracionText}" TextWrapping="NoWrap" FontSize="12" Foreground="{ThemeResource TextMain}"/>
                                <TextBlock Grid.Column="7" Text="{Binding Ticket}" TextTrimming="CharacterEllipsis" TextWrapping="NoWrap" FontSize="12" Foreground="{ThemeResource TextMain}"/>
                                <TextBlock Grid.Column="8" Text="{Binding Grupo}" TextTrimming="CharacterEllipsis" TextWrapping="NoWrap" FontSize="12" Foreground="{ThemeResource TextMain}"/>
                                <TextBlock Grid.Column="9" Text="{Binding Tipo}" TextTrimming="CharacterEllipsis" TextWrapping="NoWrap" FontSize="12" Foreground="{ThemeResource TextMain}"/>
                                
                                <!-- âœ… Estado: Pill profesional con icono y texto -->
                                <Button Grid.Column="10" 
                                        Style="{StaticResource EstadoIconButton}" 
                                        HorizontalAlignment="Center" 
                                        VerticalAlignment="Center" 
                                        ToolTipService.ToolTip="{Binding EstadoTexto}" 
                                        Tag="{Binding Id}">
                                    <!-- Pill (Badge) con fondo suave y texto -->
                                    <Border Background="{Binding StatusBackgroundColor, Converter={StaticResource HexColorToBrushConverter}}"
                                            CornerRadius="10"
                                            Padding="6,3">
                                        <StackPanel Orientation="Horizontal" Spacing="4">
                                            <!-- Icono pequeÃ±o (opcional) -->
                                            <FontIcon FontFamily="Segoe MDL2 Assets" 
                                                      Glyph="{Binding StatusIcon}" 
                                                      Foreground="{Binding StatusForegroundColor, Converter={StaticResource HexColorToBrushConverter}}" 
                                                      FontSize="10"/>
                                            <!-- Texto del estado -->
                                            <TextBlock Text="{Binding StatusText}"
                                                       Foreground="{Binding StatusForegroundColor, Converter={StaticResource HexColorToBrushConverter}}"
                                                       FontSize="10"
                                                       FontWeight="SemiBold"
                                                       VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </Border>
                                    <Button.Flyout>
                                        <MenuFlyout>
                                            <MenuFlyoutItem Text="Pausar" Click="OnPausarClick" Tag="{Binding Id}" Visibility="{Binding CanPausar, Converter={StaticResource BoolToVisibilityConverter}}">
                                                <MenuFlyoutItem.Icon>
                                                    <FontIcon FontFamily="Segoe MDL2 Assets" Glyph="&#xE769;" Foreground="#F59E0B"/>
                                                </MenuFlyoutItem.Icon>
                                            </MenuFlyoutItem>
                                            <MenuFlyoutItem Text="Reanudar" Click="OnReanudarClick" Tag="{Binding Id}" Visibility="{Binding CanReanudar, Converter={StaticResource BoolToVisibilityConverter}}">
                                                <MenuFlyoutItem.Icon>
                                                    <FontIcon FontFamily="Segoe MDL2 Assets" Glyph="&#xE768;" Foreground="#10B981"/>
                                                </MenuFlyoutItem.Icon>
                                            </MenuFlyoutItem>
                                            <MenuFlyoutItem Text="Cerrar" Click="OnCerrarClick" Tag="{Binding Id}" Visibility="{Binding CanCerrar, Converter={StaticResource BoolToVisibilityConverter}}">
                                                <MenuFlyoutItem.Icon>
                                                    <FontIcon FontFamily="Segoe MDL2 Assets" Glyph="&#xE73E;" Foreground="#3B82F6"/>
                                                </MenuFlyoutItem.Icon>
                                            </MenuFlyoutItem>
                                            <MenuFlyoutItem Text="Duplicar" Click="OnDuplicarClick" Tag="{Binding Id}" Visibility="{Binding CanDuplicar, Converter={StaticResource BoolToVisibilityConverter}}">
                                                <MenuFlyoutItem.Icon>
                                                    <FontIcon FontFamily="Segoe MDL2 Assets" Glyph="&#xE8C8;" Foreground="#8B5CF6"/>
                                                </MenuFlyoutItem.Icon>
                                            </MenuFlyoutItem>
                                        </MenuFlyout>
                                    </Button.Flyout>
                                </Button>
                            </Grid>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>
            </Grid>
        </Border>
        
        <!-- ðŸ†• OVERLAY DE CARGA - Solo ProgressRing centrado mÃ¡s abajo -->
        <Grid x:Name="LoadingOverlay"
              Grid.RowSpan="3"
              Background="#80000000"
              Visibility="Collapsed"
              Canvas.ZIndex="1000">
            <ProgressRing x:Name="LoadingRing"
                          IsActive="False"
                          Width="80"
                          Height="80"
                          Foreground="{ThemeResource Accent}"
                          VerticalAlignment="Center"
                          HorizontalAlignment="Center"
                          Margin="0,100,0,0"/>
        </Grid>
    </Grid>
</Page>
